<!DOCTYPE html>
<html lang="en-us">
  <head>    
    <meta charset="UTF-8">
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="clusterize.css" rel="stylesheet">	
	<style>
	 .scrollabletextbox {
	    float: left;
	 	width:410px;
		height:200px;
        background: url(images/green.jpg);
		background:  #abebc6;
		font-family: Verdana, Tahoma, Arial, Helvetica, sans-serif;
		font-size: 82%;
		overflow:scroll;
		}
	/*  Use in clusterize data embedded with <div class='scrollable-item'>xxxxxx</div>           */	
	/*  look under     class=scrollable-item        */	
	.scrollable-item {
		font-size: 20px;
		padding: 10px;
	}		
	.shw1{
	      margin: auto;
 		  border: 1px solid black;
		  padding: 10px;
		  width: 390px;
		  height: 200px;
		  float: left;
		  text-align: center;
		  background: url(images/a.jpg);
		  background-size: cover;
		  overflow:scroll;
		  position: relative;
		}
     .clusterize-scroll{
	     float: left;
	     margin: auto;
		 width:410px;
         border: 1px solid black;
      }	

.wordart.slate .text {
    font-family:Garamond, Times, 'Times New Roman', serif;
    font-weight: normal;
    font-size:1.15em;
    color: #00394d;
    text-shadow: 0.04em 0.03em 1px #B3B3B3;
}
         	  
	                               
	</style>
                      
	<script type="text/javascript" src="data.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
	<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
	<!-- clusterize js  is to create a smooth scroll div with many div row 10,000 no problem   -->
	<script src='clusterize.min.js'></script>
	<script>
	 var ispaused=false;
	  //----This ensure that when people hit a return key, they insert br element
	  //---not used
	  document.execCommand("defaultParagraphSeparator", false, "br");
	  $(document).ready(function() {
	    document.getElementById("playpasted").style.visibility = "hidden"; 
		document.getElementById("spkStop").style.visibility = "hidden"
		document.getElementById("us").style.visibility = "hidden"
		document.getElementById("us_").style.visibility = "hidden"
		document.getElementById("uk").style.visibility = "hidden"
		document.getElementById("uk_").style.visibility = "hidden"
		document.getElementById("chinese").style.visibility = "hidden"
		document.getElementById("chinese_").style.visibility = "hidden"
		//document.getElementById("japanese").style.visibility = "hidden"
		//document.getElementById("japanese_").style.visibility = "hidden"
	        
	    //----Detect user input into textarea
		$("#editTA").change(function() {
		   //alert('Textarea is changed');
		   document.getElementById("playpasted").style.visibility = "visible"; 
		   var sh2=document.getElementById("shw2");
 

		   //sh2.innerHTML="Textarea is changed";
		   //setTimeout(function(){ sh2.innerHTML=" "; }, 2000);
		});	  
	  
	  
	  
		   

	 
	        
	 
	 
	 
	 
	 });//$(document).ready

   
		

	</script>

	
	
   </head>
  <body>
    <section class="page-header">
      <h1 class="project-name"></h1>
    </section>

    <section class="main-content">
<!--    <h2 style="text-align:left;" onclick="MMenu();"  >&#9776;</h2>   -->
  

 <form name="theForm"> 
  <input type="checkbox" id="us" name="theGroup" onClick="clearGroup(this);"><span id="us_">US </span>
  <input type="checkbox" id="uk" name="theGroup" onClick="clearGroup(this);"><span id="uk_">UK</span>
  <input type="checkbox" id="chinese" name="theGroup" onClick="clearGroup(this);"><span id="chinese_"> Chinese</span>
<!--  <input type="checkbox" id="japanese" name="theGroup" onClick="clearGroup(this);"><span id="japanese_">Japanese</span> -->

</form> 
        
  <br/>
                                 
<div class="wordart slate"><span class="text">
Mesmerise yourself with the words of Father Moon.</span></div>

<div class="wordart slate"><span class="text">
Let the sound of the words inject life to you.
</span></div>
<br>
<div class="wordart slate"><span class="text">
&nbsp; &nbsp; &nbsp;  Click 'Play Embedded' to start.
</span></div>
   
                                   
  
	<br/><br>
    <input onclick="clusterClicked=false;embedSpk();" type='button' value='&#9654 Play Embedded' />
    <input id="playpasted" onclick="pasteSpk();" type='button' value='&#9654 Play Pasted' />
    <input id="spkStop" onclick="responsiveVoice.cancel();" type='button' value='&#9209' />
	<input id="spkPause" onclick="spkPause();" type='button' value='&#9199' />
              
	                
	<br><br> 
                 
                                                                                                           
    
	<p id="shw1" class="shw1">Click 'Play Embedded'</p>
	<p id="shw2" class="shw2"></p>
	<br><br><br><br><br><br><br><br><br><br><br><br>
	
	<!---  Display 30 characters word-phrase            -->
	<!-- Create more than 10,000 div scrollable using clusterize js  -->
	<div id="scrollArea" class="clusterize-scroll">
	  <div id="contentArea" class="clusterize-content">
		<div class="clusterize-no-data">Loading data…</div>
	  </div>
	</div>   
	                    
<br><br><br><br><br><br><br><br><br><br><br><br>   
<textarea class="scrollabletextbox" contenteditable="true" name="note" value="" id="editTA">
Paste your own Word-phrase into the green box.      
Separate each paragraph with a blank space.
Once you have completed, tap outside the box.
Click (or tap) "Play Pasted" button. 
</textarea>	  
	                           
                                                         
	<!--	
    <p contenteditable="true" id="editp" class="scrollabletextbox">
	P-element.  Paste your Word-phrase here. Separate each paragraph by a blank space.
	</p> 

    <input onclick="updateWdphrase();" type='button' value='ðŸ”Š Update P element' />
	

     <br/>
    <input onclick="updateTA();" type='button' value='ðŸ”Š Update Textarea' />
-->	
    </section>
  </body>
  
  	<script>
	     var phtotal=0, e1=0, e2=0, rnum=0;
		 var wd30char = []; // save all word-phrase first 30 chars to be displayed using clusterize.js 
		 var str1=" ";
		 var str2="";
		 var inx=0;
		 
		 var clusterClicked=false;
		 var curVoice="US English Female";
		 var curVoice="English United States";
		 
		 var embedTimeObj=0;
		 var pasteTimeObj=0;
		 var lastUserVoiceSel="";
		 phtotal=mywd.Sheet1.length; //mywd & Sheet1 is defined in  data.js file
		 
		 e1 = document.getElementById("shw1"); 
		 e2 = document.getElementById("shw2"); 
         rnum= Math.floor(Math.random() * phtotal);     // if is 10, returns a random integer from 0 to 9 
	    //phtotal=mywd.Sheet1.length;
	     rnum= Math.floor(Math.random() * phtotal);
                              
		  //---create 1000 (from data.js) div row using clusterize.js library
		 for (n=0;n<phtotal;n++){
		     var subs=mywd.Sheet1[n].Phrases.substr(0,30) ;
			 //  class='scrollable-item' is added to allow it to be scroll to the line we want
			 //  if you are not interested to programatically scroll to the text, can ignore the class
			// subs='<div class="scrollable-item">'+n+') '+subs+'</div>';
			// subs='<div>'+n+') '+subs+'</div>';
			 subs="<div onClick='clusterTxtGet()'>"+n+") "+subs+"</div>";
		     wd30char.push(subs);
		 }		 
          //---Initialise clusterize.js----   
			var clusterize = new Clusterize({
			  rows: wd30char,
			  scrollId: 'scrollArea',
			  contentId: 'contentArea'
			});		

			//----function will be used at the in embedSpk()
	/*		
			$.fn.scrollDivToElement = function(childSel) {
			    
				if (! this.length){
				    console.log("this.length NULL !!!!");
  				  return this;
				  }else{
				    console.log("this.length="+this.length.toString())
				  }

				return this.each(function() {
					let parentEl = $(this);
					let childEl = parentEl.find(childSel);
                    console.log("childEl.length="+childEl.length);
					if (childEl.length > 0) {
						parentEl.scrollTop(
							parentEl.scrollTop() - parentEl.offset().top + childEl.offset().top - (parentEl.outerHeight() / 2) + (childEl.outerHeight() / 2)
						);
					}
				});
			};
		*/	
		             
		 //-----Derive available voice list
	 function availVoiceEnable(){	 
		 var voicelist = responsiveVoice.getVoices();
		 var voiceTotal=voicelist.length;
		 for (n=0;n<voiceTotal;n++){
		    if (voicelist[n].name.toUpperCase().indexOf("US ") !=-1) {
			   document.getElementById("us_").style.visibility ="visible";
			   document.getElementById("us").style.visibility ="visible";
			   document.getElementById("us").checked = true; //ensure is checked . Default is US voice
			   console.log("found us");
			}
		    if (voicelist[n].name.toUpperCase().indexOf("UK ") !=-1) {
			   document.getElementById("uk_").style.visibility ="visible";
			   document.getElementById("uk").style.visibility ="visible";
			   console.log("found uk");
			}
		  //  if (voicelist[n].name.toUpperCase().indexOf("JAPANESE ") !=-1) {
			//   document.getElementById("japanese_").style.visibility ="visible";
			//   document.getElementById("japanese").style.visibility ="visible";
			//   console.log("found japanese");
			//}		 
		    if (voicelist[n].name.toUpperCase().indexOf("CHINESE ") !=-1) {
			   document.getElementById("chinese_").style.visibility ="visible";
			   document.getElementById("chinese").style.visibility ="visible";
			   console.log("found chinese");
			}		 
		}
	  }
       //-------------end availVoiceEnable()-----	

      setTimeout(function(){ availVoiceEnable(); }, 2000);
	      
 	                                       	      
	  function MMenu()	 {
	  
	  }

      function contEmbedSpk(){
	    embedTimeObj=setTimeout(function(){  embedSpk(); }, 2000);
	     //embedSpk();  

	  }
	  function embedSpkEnd() {
			//$("#log").text('fnished playing');
			//alert('finished playing');
			contEmbedSpk();
			
		  };	
   	             
	  function embedSpk(){
	      responsiveVoice.cancel();
		  curVoice="US English Female";
		 //phtotal=mywd.Sheet1.length;
		  if (pasteTimeObj) {
            clearTimeout(pasteTimeObj);
            pasteTimeObj = 0;
			
          }
		  //--------check only US, if last checked is not UK--------------  
		 //---update the last selected checked Voice
		 if (lastUserVoiceSel.toUpperCase().indexOf("UK ENGLISH") !=-1){
 		      curVoice=lastUserVoiceSel;
			  //--------check uk--------------  
				  document.getElementById("us").checked = false; //ensure is checked 
				  document.getElementById("uk").checked = true; //ensure is unchecked 
				  document.getElementById("chinese").checked = false; //ensure is unchecked 
				 // document.getElementById("japanese").checked = false; //ensure is unchecked 
		  }else{
		          curVoice="US English Female";
			  //--------check us--------------  
				  document.getElementById("us").checked = true; //ensure is checked 
				  document.getElementById("uk").checked = false; //ensure is unchecked 
				  document.getElementById("chinese").checked = false; //ensure is unchecked 
				//  document.getElementById("japanese").checked = false; //ensure is unchecked 

		 }		  
	     	  
                                                                                                                                                                                               
		  
		  document.getElementById("spkStop").style.visibility = "visible";

		 e1 = document.getElementById("shw1"); 
		 //e2 = document.getElementById("shw2"); 
		 
		 //---user click at the 30 chars text box
		  if (!clusterClicked){
			  var radn= Math.floor(Math.random() * phtotal);     // if is 10, returns a random integer from 0 to 9 
			  e1.innerHTML =radn+")  "+mywd.Sheet1[radn].Phrases;
			  var scrollAmt=(40)*radn
			  var txt=mywd.Sheet1[radn].Phrases
			  ispaused=false;
			  responsiveVoice.speak(txt, curVoice, {onend: embedSpkEnd}); //mobile  onend not working
		  			  
           } else{ // user clicked from the list. Speak the line user clicked
               clearTimeout(embedTimeObj); 
			   
               var radn=inx;
			   e1.innerHTML =radn+")  "+mywd.Sheet1[radn].Phrases;
			   //clusterClicked=false;
			   var txt=mywd.Sheet1[radn].Phrases
			   ispaused=false;
			    responsiveVoice.speak(txt, curVoice); //mobile  onend not working
			}		   
		  //document.getElementById('scrollArea').scrollTop = scrollAmt;
              	     	  
		  //-------Scroll <div> text to reveal current word-phrase line----
		 // console.log('.scrollable-item:eq('+radn+')');
		 // $('.clusterize-scroll').scrollDivToElement('.scrollable-item:eq('+radn+')');
		     
		//  var txt=mywd.Sheet1[radn].Phrases
	      //responsiveVoice.speak(txt);
		  //responsiveVoice.speak(txt, 'UK English Male', {onend: embedSpkEnd});
          // responsiveVoice.speak(txt, 'UK English Female');//work in mobile
		  // responsiveVoice.speak(txt, 'UK English Female', {onend: embedSpkEnd});//uk voice with callback mobile not working
		 // responsiveVoice.speak(txt, curVoice, {onend: embedSpkEnd}); //mobile  onend not working
		        
	  }	 
	  //--------end function embedSpk------------------                
 	    
      function spkPause()		{
             if (responsiveVoice.isPlaying()){
			    if (!ispaused){
			      console.log('isplaying so pause it.');
			      responsiveVoice.pause();
				  ispaused=true;
				 }else{ // ispaused=true
			 
			      console.log('not playing'); 
				  responsiveVoice.resume();
				  ispaused=false;
				}
			}	  
	  
	  }
      //-------------end spkPause()--------------
                            
      	  
      function clusterTxtGet(){
	    var res=event.srcElement.innerHTML;
	     var pos=res.indexOf(") ");
		 var inxs=res.substr(0,pos);
		 console.log(") pos="+pos);
		 inx=parseInt(inxs);
		 console.log("inx="+inx);
		 clusterClicked=true;
		// var txt=mywd.Sheet1[inx].Phrases
		// responsiveVoice.cancel();
		// responsiveVoice.speak(txt, curVoice, {onend: embedSpkEnd}); //mobile  onend not working
           embedSpk();
	  }

	      	         							
                 
      function contPasteSpk(){
	    if (embedTimeObj) {
            clearTimeout(embedTimeObj);
            embedTimeObj = 0;
        }	  
	     pasteTimeObj=setTimeout(function(){  pasteSpk(); }, 2000);
	     //pasteSpk();
	      
	  }
	  function pasteSpkEnd() {
			//$("#log").text('fnished playing');
			//alert('finished playing');
			contPasteSpk();
			
		  };
                   	     
         	         
	  function pasteSpk(){
	    responsiveVoice.cancel();
		
	    if (embedTimeObj) {
            clearTimeout(embedTimeObj);
            embedTimeObj = 0;
        }
	  
	            
		 document.getElementById("spkStop").style.visibility = "visible";
		 
		 //---update the last selected checked Voice
		 if (lastUserVoiceSel !=""){
 		   curVoice=lastUserVoiceSel;
			  //--------check only US--------------  
			  if (lastUserVoiceSel.toUpperCase().indexOf("US ENGLISH") !=-1){
				  document.getElementById("us").checked = true; //ensure is checked 
				  document.getElementById("uk").checked = false; //ensure is unchecked 
				  document.getElementById("chinese").checked = false; //ensure is unchecked 
				//  document.getElementById("japanese").checked = false; //ensure is unchecked 
			  }	  
			  //--------check only UK--------------  
			  if (lastUserVoiceSel.toUpperCase().indexOf("UK ENGLISH") !=-1){
				  document.getElementById("us").checked = false; //ensure is checked 
				  document.getElementById("uk").checked = true; //ensure is unchecked 
				  document.getElementById("chinese").checked = false; //ensure is unchecked 
				//  document.getElementById("japanese").checked = false; //ensure is unchecked 
			  }	  
			  //--------check only chinese--------------  
			  if (lastUserVoiceSel.toUpperCase().indexOf("CHINESE") !=-1){
				  document.getElementById("us").checked = false; //ensure is checked 
				  document.getElementById("uk").checked = false; //ensure is unchecked 
				  document.getElementById("chinese").checked = true; //ensure is unchecked 
				//  document.getElementById("japanese").checked = false; //ensure is unchecked 
			  }	 		 
			  //--------check only japanese--------------  
			 // if (lastUserVoiceSel.toUpperCase().indexOf("JAPANESE") !=-1){
			//	  document.getElementById("us").checked = false; //ensure is checked 
			//	  document.getElementById("uk").checked = false; //ensure is unchecked 
			//	  document.getElementById("chinese").checked = false; //ensure is unchecked 
			//	  document.getElementById("japanese").checked = true; //ensure is unchecked 
			 // }	 
		  }
		 //------End if  (lastUserVoiceSel !="")
         		 
      		     
	     var taTxt=document.getElementById("editTA").value;
		 var s=taTxt.split(/\n\s*\n/); //detect empty line and split them into array
		// var nump=s.length; // total paragraph
		 var phtotal=s.length; // total paragraph
		 e1 = document.getElementById("shw1"); 
		 //e2 = document.getElementById("shw2"); 
          var radn= Math.floor(Math.random() * phtotal);     // if is 10, returns a random integer from 0 to 9 
		  e1.innerHTML =s[radn]
		  var txt=s[radn];
	     // responsiveVoice.speak(txt);
		  ispaused=false;
		  responsiveVoice.speak(txt, curVoice, {onend: pasteSpkEnd});
	                
	  }           
	                     
    //----checkboxes checked & unchecked	 
    function clearGroup(elem) {
        var group = document.theForm.theGroup;
        for (var i=0; i<group.length; i++) {
            if (group[i] != elem) {
                group[i].checked = false;
			}
			else{
			   if (group[i].getAttribute("id").toUpperCase().indexOf("US")!=-1){
			      curVoice="US English Female";
				  lastUserVoiceSel="US English Female";
			   }
			   if (group[i].getAttribute("id").toUpperCase().indexOf("UK")!=-1){
			      curVoice="UK English Female";
				  lastUserVoiceSel="UK English Female";
			   }
			   if (group[i].getAttribute("id").toUpperCase().indexOf("CHINESE")!=-1){
			      curVoice="Chinese Female";
				  lastUserVoiceSel="Chinese Female";
			   }
			  // if (group[i].getAttribute("id").toUpperCase().indexOf("JAPANESE")!=-1){
			   //   curVoice="Japanese Female";
				//  lastUserVoiceSel="Japanese Female";
			  // }			   
            }
        }
    }
      
            	        

	  function updateWdphrase(){
	     var obj=document.getElementById("editp");
	     alert(obj.innerHTML)
	  }
	  //------not used
	  function updateTA(){
	    // var obj=document.getElementById("editTA");
	     var taTxt=document.getElementById("editTA").value;
		 
		 //var s = taTxt.split(/\r?\n/);
		 var s=taTxt.split(/\n\s*\n/); //detect empty line and split them into array
		 
		 var nump=s.length; // total paragraph
		// alert(nump.toString());

		 var txt="Total paragraph="+nump.toString();
	     alert(txt.concat("\n 1) ",s[0],"\n 2) ",s[1], "\n 3) ", s[2]));
	  } 
    
	     
	
	</script>
  
  
</html>

